# gitlab‚Äëgithub‚Äëmirror‚Äëtest

–ú–∏–Ω–∏‚Äë–ø–µ—Å–æ—á–Ω–∏—Ü–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è‚ÄØ–¥–≤–∞ –ø—Ä–∏—ë–º–∞:

1. **–ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è GitHub‚ÄØ‚Üí‚ÄØGitLab**  
   (`mirror-repo-homeless-edition.js` –∫—Ä—É—Ç–∏—Ç—Å—è –≥–¥–µ —É–≥–æ–¥–Ω–æ ‚Äî¬†—Ö–æ—Ç—å –Ω–∞ –Ω–æ—É—Ç–µ, —Ö–æ—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ ‚Äî¬†–∏ —Ä–∞–∑ –≤‚ÄØ`INTERVAL_SEC` —Ç—è–Ω–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ GitHub –∏ –ø—É—à–∏—Ç –∏—Ö –≤¬†GitLab).

2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è ¬´–∫–æ–Ω—Ñ–ª–∏–∫—Ç‚Äë—Ñ–∞–π–ª–∞¬ª –≤ –≤–µ—Ç–∫–µ `development`**  
   GitLab‚ÄëCI –∑–∞–ø—É—Å–∫–∞–µ—Ç `conflict-job.js`‚ÄØ‚Üí‚ÄØ—Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—ë—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç `dev_conflict.txt`, –∫–æ–º–º–∏—Ç–∏—Ç –∏ –ø—É—à–∏—Ç –≤ GitHub.  
   –ï—Å–ª–∏ –∫—Ç–æ‚Äë—Ç–æ —É—Å–ø–µ–ª –∑–∞–ø—É—à–∏—Ç—å —Ä–∞–Ω—å—à–µ ‚Äî¬†–ø–æ–ª—É—á–∞—Ç —Ä–µ–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏ –ø–æ–π–º—É—Ç, —á—Ç–æ –ª–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞.

---

## –°–æ—Å—Ç–∞–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

| —Ñ–∞–π–ª                            | –∑–∞—á–µ–º –Ω—É–∂–µ–Ω                                                                              |
|---------------------------------|------------------------------------------------------------------------------------------|
| `.gitlab-ci.yml`                | –æ–¥–Ω–∞ —Å—Ç–∞–¥–∏—è¬†`conflict`, –≤—ã–ø–æ–ª–Ω—è–µ—Ç `node conflict-job.js`                                 |
| `conflict-job.js`               | –≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç –≤–µ—Ç–∫—É **development**, –∑–æ–≤—ë—Ç `generate-dev-conflict.js`, –ø—É—à–∏—Ç –æ–±—Ä–∞—Ç–Ω–æ        |
| `generate-dev-conflict.js`      | –ø–∏—à–µ—Ç –≤¬†`dev_conflict.txt` UID, –¥–∞—Ç—É, —Ö–µ—à –∫–æ–º–º–∏—Ç–∞ +¬†1000 —Å—Ç—Ä–æ–∫ —à—É–º–∞ –¥–ª—è —É–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ |
| `mirror-repo-homeless-edition.js` | ¬´—Ä–∞–Ω–Ω–µ—Ä –¥–ª—è –±–µ–¥–Ω—ã—Ö¬ª: –æ–±—ã—á–Ω—ã–π Node‚Äë—Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏ –∑–µ—Ä–∫–∞–ª–∏—Ç GitHub¬†‚Üí¬†GitLab     |
| `gitlab-docker-compose.yml`*    | –±—ã—Å—Ç—Ä—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π¬†CE GitLab (–ø–æ—Ä—Ç¬†`8929`)                                                |
| `dev_conflict.txt`              | —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä                                                                  |

\*¬†–§–∞–π–ª –ª–µ–∂–∏—Ç –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞, –≤ CI –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç.

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. GitHub ‚Üí GitLab –∑–µ—Ä–∫–∞–ª–æ
```bash
# –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚Äî¬†–∫–∞–∫ –º–∏–Ω–∏–º—É–º —Ç–æ–∫–µ–Ω—ã
set REMOTE_REPO=https://<GH_TOKEN>@github.com/<user>/<repo>.git
set GITLAB_REPO=http://localhost:8929/root/gitlab-github-mirror-test.git
set GITLAB_USER=root
set GITLAB_PASS=<GL_TOKEN_OR_PASS>
node mirror-repo-homeless-edition.js
````

–°–∫—Ä–∏–ø—Ç `mirror-repo-homeless-edition.js` —Å–∞–º —Å–æ–∑–¥–∞—ë—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π bare‚Äë–∫–ª–æ–Ω, –º–µ–Ω—è–µ—Ç push‚Äëremote –Ω–∞¬†GitLab –∏ –¥–µ–ª–∞–µ—Ç `git push --mirror`.
–ü–æ‚Äë—É–º–æ–ª—á–∞–Ω–∏—é –∏–Ω—Ç–µ—Ä–≤–∞–ª‚ÄØ‚Äî‚ÄØ60‚ÄØ—Å–µ–∫—É–Ω–¥, –ø—Ä–∞–≤–∏—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π¬†`INTERVAL_SEC`.

### 2. –ö–æ–Ω—Ñ–ª–∏–∫—Ç‚Äë–¥–∂–æ–±–∞

* –ù–∞ GitLab‚Äë–∏–Ω—Å—Ç–∞–Ω—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—à—å **shell‚Äërunner** —Å —Ç–µ–≥–æ–º `runner`.
* –í¬†–ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö CI/CD –ø—Ä–æ–µ–∫—Ç–∞ –∑–∞–≤–æ–¥–∏—à—å `GITHUB_TOKEN`.
* –ü—É—à–∏—à—å –≤ `development` ‚Äî¬†GitLab‚ÄëCI –∑–∞–ø—É—Å–∫–∞–µ—Ç `generate_and_push_conflict`, —Ñ–∞–π–ª –ø–æ—è–≤–ª—è–µ—Ç—Å—è (–∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è) –ø—Ä—è–º–æ –≤¬†GitHub‚Äë—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω—ã

| –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è     | –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è                  | —á—Ç–æ –ø–æ–ª–æ–∂–∏—Ç—å                                       |
| -------------- | --------------------------------- | -------------------------------------------------- |
| `GITHUB_TOKEN` | `conflict-job.js`                 | GitHub¬†PAT —Å –ø—Ä–∞–≤–æ–º **repo\:write**                |
| `INTERVAL_SEC` | `mirror-repo-homeless-edition.js` | –∑–∞–¥–µ—Ä–∂–∫–∞ –≤‚ÄØ—Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ¬†—É–º–æ–ª—á–∞–Ω–∏—é¬†60)              |
| `GITLAB_PASS`  | `mirror-repo-homeless-edition.js` | –ø–∞—Ä–æ–ª—å –∏–ª–∏ personal‚Äëtoken GitLab (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω push) |

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∫–æ—Ä–æ—Ç–∫–æ)

```mermaid
flowchart LR
  GH[GitHub repo]
  JS[mirror-repo-homeless-edition.js]
  GL[GitLab repo]
  CI[GitLab Runner conflict-job.js]
  DEV[branch development]
  SKIP((skip))

  GH -->|git clone --mirror| JS
  JS -->|git push --mirror| GL
  GL -->|push to DEV triggers pipeline| CI

  CI -->|dev_conflict.txt missing: create and push| GH
  CI -->|dev_conflict.txt exists: skip| SKIP
```

---

## –ß–µ–≥–æ —Ç—É—Ç **–Ω–µ—Ç**

* Bidirectional mirror (–≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã) ‚Äî¬†–∑–¥–µ—Å—å —Ç–æ–ª—å–∫–æ GitHub¬†‚Üí¬†GitLab (–∫—Ä–æ–º–µ –≤–µ—Ç–∫–∏ development, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å `dev_conflict.txt`. –¢–æ–≥–¥–∞ GitLab¬†‚Üí¬†GitHub).
* –°–∏–Ω—Ö—Ä–æ–Ω–∞ issues / PR¬†‚Äî —Ç–æ–ª—å–∫–æ –∫–æ–¥.
* –ó–∞—â–∏—Ç—ã –æ—Ç ¬´–¥–µ–¥–ª–æ–∫–∞¬ª, –∫–æ–≥–¥–∞ –æ–±–∞ —Å–∫—Ä–∏–ø—Ç–∞ –ø—É—à–∞—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–¥–ª—è –¥–µ–º–æ –Ω–µ –Ω—É–∂–Ω–æ).

---

## TODO/–∏–¥–µ–∏

* –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å mirror‚Äë—Å–∫—Ä–∏–ø—Ç –Ω–∞ cron‚Äëjob –≤–Ω—É—Ç—Ä–∏ Docker‚Äë–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
* –î–æ–±–∞–≤–∏—Ç—å Slack¬†/ Telegram –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, –µ—Å–ª–∏ push —É–ø–∞–ª –Ω–µ¬†fast‚Äëforward.
* –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å badge ‚ÄúLast mirror OK / FAIL‚Äù –ø—Ä—è–º–æ –≤ README.

---

### –õ–∏—Ü–µ–Ω–∑–∏—è

MIT @ vibe coding edition

–î–µ–ª–∞–π—Ç–µ —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ, –µ—Å–ª–∏ —á—Ç–æ‚Äë—Ç–æ —Å–≥–æ—Ä–∏—Ç ‚Äî¬†–≤—ã –±—ã–ª–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω—ã ü§ü
